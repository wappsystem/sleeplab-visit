<section>
    <div id=toolbar__ID>
          Email
    </div>
    <div style='padding:30px'>
        <div id=contents__ID>
            Dear <span id=patient__ID></span>, <br><br>This letter confirms your appointment with <b><span id=doctor__ID></span></b>  at Woolcock Clinic, <b><span id=location__ID></span></b><br>
            <br>
            <b></b>
            <br><br>
            Your appointment details are: <br>
            <i>When:</i> <b><span id=date__ID></span> at <span id=appointment_time__ID></span> with <span id=doctor2__ID></span></b><br><br>
            <i>Where:</i><br>
            <b>Woolcock Clinic</b><br>
            <br><br>
            <br>
            <u><a id=q_n href="#" target="_blank" >Click here to access Online questionnaires</a></u> <br>
            Please use the following to get access to your questionnaires<br>
			Login ID: <b><span id=Login_ID__ID></span></b><br>
			Password: <b><span id=Password__ID></span></b><br>

			<br>
            We look forward to seeing you at your visit.</b>

            <br>
            <br>
            <b>Kind regards,<br><br>

            </b>
        </div>
        <br><br>
        <input type=button id=send__ID value=Send class="btn btn-secondary"/>
        <input style="display:none" id=password__ID type=password placeholder="Password"></input>
    </div>
</section>
<script>
    function F__ID(){
        //-------------------------------------
		var prefix=$vm.module_list[$vm.vm['__ID'].name].prefix; if(prefix==undefined) prefix="";
		var pid=$vm.module_list[$vm.vm['__ID'].name].table_id
		var record;
        //-------------------------------------
        $('#D__ID').on('load',function(){
            if($vm.vm['__ID'].op.input==undefined) record={};
    		//if($vm.vm['__ID'].op.input.record==undefined) return; //no parent;

            if($vm.server=="development") $('#password__ID').show();
			record=$vm.vm['__ID'].op.input.record;
            $('#patient__ID').text(record.First_Name+' '+record.Last_Name);
			$('#Login_ID__ID').text(record.UID+'-'+pid);
            $('#Password__ID').text(record.Password);
            $('#location__ID').text(record.Location);
            $('#doctor__ID').text(record.Physician);
            $('#doctor2__ID').text(record.Physician);
            $('#appointment_time__ID').text(record.Appointment_Time);
            var appoint_date=record.Date.split('-');
            var months=['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            $('#date__ID').text(appoint_date[2]+' '+months[parseInt(appoint_date[1])-1]+' '+appoint_date[0]);
            var d="?visit=initial";
            if($vm.server=='development'){
                d=d+"&database=development&username="+record.UID+'-'+pid+"&password="+record.Password;
            }
            var q_url="https://wappsystem.github.io/woolcock-clinic-patient-portal/index.html"+d;
            if(window.location.hostname=='127.0.0.1' || window.location.hostname=='localhost'){
                q_url=q_url.replace("https://wappsystem.github.io","http://127.0.0.1:8000/wappsystem")
            };
            $(document).ready(function() {
                $('#q_n').attr('href',q_url);
            });
        })

        //-------------------------------------
        $('#send__ID').on('click',function(){
            var Subject="Woolcock Clinic Online Registration and Questionnaires";
            var To=record.Email;
            var Body=$('#contents__ID').html();
            var Password=$('#password__ID').val();
            var req={cmd:'send-email',qid:$vm.qid,'permission-query':'send-email',db_pid:'20011597',Password:Password,To:To,Subject:Subject,Body:Body}
            $VmAPI.request({data:req,callback:function(res){
                if(res.ret==1){
                    $vm.alert("The email has been sent out to "+To);
                    /*
                    var data={Subject:Subject,To:To}
                    var dbv={S1:Subject,S2:To}
                    var req={cmd:"add",qid:$vm.qid,db_pid:'20011579',data:data,dbv:dbv};
                    $VmAPI.request({data:req,callback:function(res){
                    }});
                    */
                }
                else{
                    $vm.alert("Error");
                }
            }});
        })
    }
</script>
<style>
    VmInclude:__PARTS__/style/default.css
</style>
