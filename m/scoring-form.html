<div id=D__ID>
	<!--third html start -->
	<div class="container mt-95 mb-3">
		<div class="row">
			<!-- form container start -->
			<div class="col-12 col-lg-12 col-md-12 col-sm-12 mx-auto formbox">
				<div class="row">
					<div class="col-12">
						<!-- form start -->
						<form id="F__ID">
							<h3>Scoring - <span id=Date__ID class="">Date</span></h3>
							<div>
								<div class="form-group">
									<div class="questiongroup">
										<fieldset class="subquestions">
											<label><span id=Patient__ID class=""></span></label><br>
											<label><span id=Item_Number_Procedure__ID class=""></span></label><br>
											<label><span id=Charge__ID class=""></span></label><br>
											<label><span id=Research_Project__ID class=""></span></label><br>
										</fieldset>
									</div>
								</div>
								<div class="form-group">
									<div class="questiongroup">
										<fieldset class="">
											<div>
											<button type="button" id="show_hide_setup__ID" class="btn btn-primary mb-1 mt-0 mx-0 p-1">Show Study Notes</button>
										</div><div>
											<label><span id=setup_notes__ID class=""></span></label>
										</div>
										</fieldset>
									</div>
								</div>
								<div class="form-group ">
									<div class="questiongroup ">
										<fieldset class="subquestions">
											<div class="row">
												<div class="col-lg-6 col-sm-12">
													<div><label><span class="">Scorer</span></label></div>
													<div class="input-group-sm ">
														<input type="text" class="form-control" name=Scorer  placeholder="lookup..." />
													</div>
												</div>
												<div class="col-lg-2 col-sm-12">
													<div><label><span class="">Scorer ID</span></label></div>
													<div class="input-group-sm">
														<input type="text" class="form-control" name=Scorer_uid required readonly />
													</div>
												</div>	
												<div class="col-lg-4 col-sm-12">
													<div><label><span class="">Scoring Date</span></label></div>
													<div class="input-group-sm ">
														<input type="date" class="form-control" name=Scoring_Date />
													</div>
												</div>
											</div>
										</fieldset>
									</div>
								</div>
								<div class="form-group ">
									<div class="questiongroup ">
										<fieldset class="subquestions">
											<div class="row">
												<div class="col-lg-6 col-sm-12">
													<label class="checkboxes">
														<input type="checkbox" class="form-control" name=Scoring_No />
														<span class="check_checkmark"></span>Scoring NOT Required
													</label>
													<label class="checkboxes">
														<input type="checkbox" class="form-control" name=QA />
														<span class="check_checkmark"></span>QA Required
													</label><br>
												</div>
											</div>
										</fieldset>
									</div>
								</div>
								<div id=scoring_rb__ID>
									<div class="form-group ">
										<div class="questiongroup ">
											<fieldset class="subquestions">
												<div class="row">
													<div class="col-lg-12 col-sm-12">
														<fieldset>
															<div><label>Scoring Status</label></div>
															<label class="radiobuttons">
																<input type="radio" name="Scoring_Status" value="Unscored" checked required>
																<span class="checkmark"></span> Unscored
															</label><br>
															<label class="radiobuttons">
																<input type="radio" name="Scoring_Status" value="Inprogress">
																<span class="checkmark"></span> Inprogress (sent to scorer)
															</label><br>
															<label class="radiobuttons">
																<input type="radio" name="Scoring_Status" value="Scored">
																<span class="checkmark"></span> Scored
															</label><br>
															<label class="radiobuttons" id=qa_option__ID>
																<input type="radio" name="Scoring_Status" value="QAed">
																<span class="checkmark"></span> Quality Assured
															</label><br>
														</fieldset>
													</div>
												</div>
											</fieldset>
										</div>
									</div>
								</div>
								<div class="form-group ">
									<div class="questiongroup ">
										<fieldset class="subquestions">
											<div class="row">
												<div class="col-lg-12 col-sm-12">
													<div><label><span class="">Scoring Status log</span></label></div>
													<div class="input-group-sm">
														<textarea style='font-size:12px' class="form-control" name=Scoring_status_log id=Scoring_status_log__ID ></textarea>
													</div>
												</div>
											</div>
										</fieldset>
									</div>
								</div>
								<div id=qad__ID>
									<div class="form-group ">
										<div class="questiongroup ">
											<fieldset class="subquestions">
												<div class="row">
													<div class="col-lg-6 col-sm-12">
														<div><label><span class="">Quality Assured By</span></label></div>
														<div class="input-group-sm ">
															<input type="text" class="form-control" name=QAd  placeholder="lookup..." />
														</div>
													</div>
													<div class="col-lg-2 col-sm-12">
														<div><label><span class="">Scorer ID</span></label></div>
														<div class="input-group-sm">
															<input type="text" class="form-control" name=QAd_uid required readonly />
														</div>
													</div>	
												</div>
											</fieldset>
										</div>
									</div>
								</div>
								 <div class="form-group ">
									<div class="questiongroup ">
										<fieldset class="subquestions">
											<div class="row">
												<div class="col-lg-12 col-sm-12">
													<div class="input-group-sm ">
														<label><span class=""><u style='cursor:pointer;margin-bottom:3px;display:inline-block' id=add_note__ID><i class="fa fa-plus"></i> Click here to add notes</u></span></label>
														<textarea style="overflow:hidden" onkeyup="textAreaAdjust__ID(this)" class="form-control" id=Added_Note__ID placeholder="enter new notes here.." ></textarea>
													</div>
												</div>
											</div>
										</fieldset>
									</div>
								</div>
								<div class="form-group ">
									<div class="questiongroup ">
										<fieldset class="subquestions">
											<div class="row">
												<div class="col-lg-12 col-sm-12">
													<div><label><span class="">Notes</span></label></div>
													<div class="input-group-sm">
														<textarea style='font-size:12px' class="form-control" name=Notes id=Notes__ID ></textarea>
													</div>
												</div>
											</div>
										</fieldset>
									</div>
								</div>
								<button type="submit" id="submit__ID" class="btn btn-primary btn-lg">Submit</button>
								<button id=delete__ID type="button" class="btn btn-primary btn-lg">Delete</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
    <script>
		function textAreaAdjust__ID(o) {
			console.log(o)
			o.style.height = "1px";
			o.style.height = (25+o.scrollHeight)+"px";
		}
		//-------------------------------------
			VmInclude:__COMPONENT__/f/form.01.js
		//-------------------------------------
		function F__ID(){
    		//-------------------------------------
           old_load=m.load;
			m.load=function(){
				old_load();
				if(m.input.booking!=undefined){
					if(m.input.booking.Data!=undefined){
						if(m.input.booking.Data.Date!=undefined) $('#Date__ID').html(m.input.booking.Data.Date)
						if(m.input.booking.Data.Patient!=undefined) $('#Patient__ID').text("[ "+m.input.booking.Data.Patient + " ] ")
						if(m.input.booking.Data.Item_Number_Procedure!=undefined) $('#Item_Number_Procedure__ID').text("[ "+m.input.booking.Data.Item_Number_Procedure + " ] ")
						if(m.input.booking.Data.Charge!=undefined) $('#Charge__ID').text("[ "+m.input.booking.Data.Charge + "] ")
						if(m.input.booking.Data.Research_Project!=undefined) {
							if (m.input.booking.Data.Research_Project != "") {
								$('#Research_Project__ID').text("[ "+ m.input.booking.Data.Research_Project + " ] ")
							}
						}
					}
				}
				if(m.input.setup!=undefined){
					if(m.input.setup.Data!=undefined){
						console.log(JSON.stringify(m.input.setup.Data))
						if(m.input.setup.Data.Notes!=undefined) {
							var notes=m.input.setup.Data.Notes
							notes=notes.replace(/\n/g,'<br>').replace(/\r/g,'')
							$('#setup_notes__ID').html(notes)
						}
						else $('#setup_notes__ID').html("")
					}
				}
				//-------------------------------------
				if($('#F__ID input[name=QA]:checked').val()=='on'){
					$('#qa_option__ID').show();
					$('#qad__ID').show();
				}
				else {
					$('#qa_option__ID').hide();
					$('#qad__ID').hide();
				}
				//-------------------------------------
				$('#setup_notes__ID').hide()
				//-------------------------------------
				if($('#F__ID input[name=Scoring_No]:checked').val()=='on'){
					$('#scoring_rb__ID').hide();
				}
				else $('#scoring_rb__ID').show();
			}
            //-------------------------------------
			$('#F__ID input[name=QA]').on('click',function(){
				if($('#F__ID input[name=QA]:checked').val()=='on'){
					$('#qa_option__ID').show();
					$('#qad__ID').show();
				}
				else {
					$('#qa_option__ID').hide();
					$('#qad__ID').hide();
				}
			});
            //-------------------------------------
			$('#F__ID input[name=Scoring_No]').on('click',function(){
				if($('#F__ID input[name=Scoring_No]:checked').val()=='on'){
					$('#scoring_rb__ID').hide();
				}
				else $('#scoring_rb__ID').show();
			});
            //-------------------------------------
			$('#show_hide_setup__ID').on('click', function () {
				if ($('#show_hide_setup__ID').text() == 'Hide Setup Notes') {
				$('#show_hide_setup__ID').text('Show Setup Notes');
				$('#setup_notes__ID').hide();
				}
				else {
				$('#show_hide_setup__ID').text('Hide Setup Notes');
				$('#setup_notes__ID').show();
				}
			});
            //-------------------------------------
			$('#F__ID input[name=Scoring_Status]').on('click',function(){
				console.log($('#F__ID input[name=Scoring_Status]:checked').val())
				var now_time=new Date();
				now_time=now_time.toString().split(" ");
				now_time=now_time[4];
				var now_date=$vm.date_to_string_dmy(new Date());
				var new_status= $('#F__ID input[name=Scoring_Status]:checked').val()
				var old_status=$('#F__ID textarea[name=Scoring_status_log]').val()
					if($('#F__ID textarea[name=Scoring_status_log]').val()==undefined) old_status="";
					var notes=new_status+" - "+now_time+' '+now_date+" - "+$vm.user_name+"\n"+old_status
					$('#F__ID textarea[name=Scoring_status_log]').val(notes)
					var nota=1;
					var note_row=0;
					while(nota >= 0 ){
						nota=notes.indexOf('\n');
						if (nota>0) note_row++;
						notes=notes.substring(nota+1)
					}
					if(old_status!="") note_row++;
					$('#Notes__ID').css('height',note_row*19+'px')
			});
			//-------------------------------------
			$('#add_note__ID').on('click',function(){
				var now_time=new Date();
				now_time=now_time.toString().split(" ");
				now_time=now_time[4];
				var now_date=$vm.date_to_string_dmy(new Date());
				var new_notes=$('#Added_Note__ID').val();
				if(new_notes!=""){
					var old_notes=$('#F__ID textarea[name=Notes]').val()
					if($('#F__ID textarea[name=Notes]').val()==undefined) old_notes="";
					var notes=now_time+' '+now_date+" - "+$vm.user_name+"\n"+new_notes+"\n\n"+old_notes
					$('#F__ID textarea[name=Notes]').val(notes)
					var nota=1;
					var note_row=0;
					while(nota >= 0 ){
						nota=notes.indexOf('\n');
						if (nota>0) note_row++;
						notes=notes.substring(nota+1)
					}
					if(old_notes!="") note_row++;
					$('#Added_Note__ID').val("");
					$('#Added_Note__ID').css('height','58px');
					$('#Notes__ID').css('height',note_row*19+'px')
				}
				else $vm.alert("Please enter a comment")				
			})
			//-------------------------------------
			m.before_submit=function(data,index){
				data.booking_uid=m.input.booking.UID;
				index.I1=m.input.booking.Data.Date;
                //index.I2=data.Time;

            }
			//-------------------------------------
			var autocomplete_req={cmd:"find",field:'.Data.First_Name',table:m.lookup,query:{},options:{},skip:0,limit:10}
			var autocomplete_callback=function(item){
				$('input[name=Scorer').val(item.label);
				$('input[name=Scorer_uid').val(item.UID);
			}
			var autocomplete_list=function(records){
				var items=[];
				for(var i=0;i<records.length;i++){
					var obj={};
					obj.label=records[i].Data["First_Name"]+" "+records[i].Data["Last_Name"];
					obj.UID=records[i].UID;
					items.push(obj);
				}
				return items;
			}
			var wait=function(){
				$vm.autocomplete( $('#F__ID input[name=Scorer'),autocomplete_req,autocomplete_list,autocomplete_callback);
			}
			var I=0; var loop_2=setInterval(function (){
				if($vm['jquery-ui-min-js']!=undefined){  clearInterval(loop_2); wait(); }
				I++; if(I>50){ clearInterval(loop_2); alert("jquery-ui.min.js is not installed."); }
			},100);
			//-------------------------------------
			var autocomplete_req2={cmd:"find",field:'.Data.First_Name',table:m.lookup,query:{},options:{},skip:0,limit:10}
			var autocomplete_callback2=function(item){
				$('input[name=QAd').val(item.label);
				$('input[name=QAd_uid').val(item.UID);
			}
			var autocomplete_list2=function(records){
				var items=[];
				for(var i=0;i<records.length;i++){
					var obj={};
					obj.label=records[i].Data["First_Name"]+" "+records[i].Data["Last_Name"];
					obj.UID=records[i].UID;
					items.push(obj);
				}
				return items;
			}
			var wait2=function(){
				$vm.autocomplete( $('#F__ID input[name=QAd'),autocomplete_req2,autocomplete_list2,autocomplete_callback2);
			}
			var I2=0; var loop_22=setInterval(function (){
				if($vm['jquery-ui-min-js']!=undefined){  clearInterval(loop_22); wait2(); }
				I2++; if(I>50){ clearInterval(loop_22); alert("jquery-ui.min.js is not installed."); }
			},100);
		}
		//-------------------------------

    </script>
    <style>
        #form_container__ID{
            max-width:800px;
        }
        VmInclude:__CURRENT_PATH__/wappsystem-form.css
    </style>
</div>
